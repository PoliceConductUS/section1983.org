---
import { getCollection, render } from "astro:content";
import Article from "../../layouts/Article.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import PrevNext from "../../components/PrevNext.astro";

export async function getStaticPaths() {
  const articles = await getCollection("articles", ({ data }) => !data.draft);
  const sorted = articles.sort((a, b) => {
    const da = a.data.pubDate ? new Date(a.data.pubDate).getTime() : 0;
    const db = b.data.pubDate ? new Date(b.data.pubDate).getTime() : 0;
    return db - da;
  });
  return sorted.map((article, i) => ({
    params: { slug: article.id },
    props: {
      article,
      prev: i < sorted.length - 1 ? sorted[i + 1] : null,
      next: i > 0 ? sorted[i - 1] : null,
    },
  }));
}

const { article, prev, next } = Astro.props;
const { Content } = await render(article);
---

<Article
  title={article.data.title}
  description={article.data.description}
  pubDate={article.data.pubDate}
  author={article.data.author}
  tags={article.data.tags}
>
  <Breadcrumbs
    slot="breadcrumbs"
    crumbs={[
      { label: "Home", href: "/" },
      { label: "Articles", href: "/articles" },
      { label: article.data.title },
    ]}
  />
  <Content />
  <PrevNext
    slot="pagination"
    prev={prev
      ? { href: `/articles/${prev.id}`, label: prev.data.title }
      : null}
    next={next
      ? { href: `/articles/${next.id}`, label: next.data.title }
      : null}
  />
</Article>
